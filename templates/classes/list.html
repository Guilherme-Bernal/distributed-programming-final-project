{% extends 'base/base.html' %}

{% block title %}All Classes - Class Manager{% endblock %}

{% block content %}
<div class="mb-8">
    <div class="flex justify-between items-center mb-4">
        <h2 class="text-4xl font-bold text-gray-800">Available Classes</h2>
        {% if user.is_authenticated and user.teacher_profile %}
        <a href="{% url 'classes:create' %}" 
           class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-6 rounded-lg transition-colors">
            + Create New Class
        </a>
        {% endif %}
    </div>
    
    <!-- Search and Filters -->
    <div class="bg-white rounded-lg shadow-md p-4 mb-6">
        <form method="get" class="flex flex-wrap gap-4">
            <input type="text" name="search" placeholder="Search classes, subjects, or teachers..." 
                   value="{{ request.GET.search }}"
                   class="flex-1 min-w-[300px] px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            
            <select name="semester" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                <option value="">All Semesters</option>
                <option value="2024.1" {% if request.GET.semester == "2024.1" %}selected{% endif %}>2024.1</option>
                <option value="2024.2" {% if request.GET.semester == "2024.2" %}selected{% endif %}>2024.2</option>
                <option value="2025.1" {% if request.GET.semester == "2025.1" %}selected{% endif %}>2025.1</option>
                <option value="2025.2" {% if request.GET.semester == "2025.2" %}selected{% endif %}>2025.2</option>
            </select>
            
            <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg transition-colors">
                ğŸ” Search
            </button>
            
            {% if request.GET.search or request.GET.semester %}
            <a href="{% url 'classes:list' %}" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded-lg transition-colors">
                âœ• Clear
            </a>
            {% endif %}
        </form>
    </div>
</div>

{% if classes %}
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
    {% for class in classes %}
    <div class="bg-white border border-gray-200 rounded-lg p-6 hover:shadow-xl transition-shadow">
        <!-- Header -->
        <div class="flex items-center justify-between mb-4">
            <span class="text-sm font-semibold text-blue-600 bg-blue-100 px-3 py-1 rounded-full">
                {{ class.subject.code }}
            </span>
            <span class="text-sm text-gray-500">{{ class.semester }}</span>
        </div>
        
        <!-- Title -->
        <h3 class="text-xl font-bold text-gray-900 mb-3">{{ class.subject.name }}</h3>
        
        <!-- Details -->
        <div class="space-y-2 text-sm text-gray-600 mb-4">
            <p><strong>ğŸ‘¨â€ğŸ« Teacher:</strong> {{ class.teacher.full_name }}</p>
            <p><strong>ğŸ• Schedule:</strong> {{ class.schedule }}</p>
            <p><strong>ğŸšª Room:</strong> {{ class.room|default:"TBA" }}</p>
            <p><strong>ğŸ‘¥ Seats:</strong> 
                <span class="{% if class.is_full %}text-red-600{% else %}text-green-600{% endif %} font-semibold">
                    {{ class.available_seats }}/{{ class.max_students }}
                </span>
            </p>
        </div>
        
        <!-- Enrollment Status for Students -->
        {% if user.is_authenticated and user.student_profile %}
            {% if user.student_profile in class.students.all %}
            <div class="bg-green-100 border border-green-400 text-green-700 px-3 py-2 rounded mb-3 text-sm">
                âœ“ You are enrolled
            </div>
            {% endif %}
        {% endif %}
        
        <!-- Actions -->
        <a href="{% url 'classes:detail' class.pk %}" 
           class="block w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg text-center transition-colors">
            View Details
        </a>
    </div>
    {% endfor %}
</div>

{% if request.GET.search or request.GET.semester %}
<div class="mt-6 text-center text-gray-600">
    Showing {{ classes.count }} result{{ classes.count|pluralize }}
</div>
{% endif %}

{% else %}
<div class="bg-white rounded-lg shadow-md p-12 text-center">
    <div class="text-6xl mb-4">ğŸ“š</div>
    {% if request.GET.search %}
    <h3 class="text-2xl font-bold text-gray-700 mb-2">No Results Found</h3>
    <p class="text-gray-500 mb-6">Try adjusting your search terms or filters.</p>
    <a href="{% url 'classes:list' %}" 
       class="inline-block bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors">
        View All Classes
    </a>
    {% else %}
    <h3 class="text-2xl font-bold text-gray-700 mb-2">No Classes Available</h3>
    <p class="text-gray-500 mb-6">No classes have been created yet.</p>
    {% if user.is_authenticated and user.teacher_profile %}
    <a href="{% url 'classes:create' %}" 
       class="inline-block bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors">
        Create First Class
    </a>
    {% else %}
    <a href="/admin/" class="inline-block bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors">
        Go to Admin Panel
    </a>
    {% endif %}
    {% endif %}
</div>
{% endif %}
{% endblock %}